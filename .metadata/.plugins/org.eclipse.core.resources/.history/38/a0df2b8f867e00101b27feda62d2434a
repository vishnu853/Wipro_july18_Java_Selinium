package Hooks;

import java.io.File;

import org.apache.commons.io.FileUtils;
import org.openqa.selenium.OutputType;
import org.openqa.selenium.TakesScreenshot;
import org.openqa.selenium.WebDriver;

import io.cucumber.java.After;
import io.cucumber.java.Before;
import io.cucumber.java.Scenario;
import utils.DriverFactory;

public class Hooks 
{
	 
	// Inject WebDriver from DriverFactory
		 @Before
		 public void setUp() {
			 DriverFactory.getDriver();
			 System.out.println("Browser launched before scenario");
		 }
		 @After
		 public void tearDown(Scenario scenario) 
		 {
			 if (scenario.isFailed()) 
			 {
			        try {
			            // Take screenshot
			            File srcFile = ((TakesScreenshot) driver).getScreenshotAs(OutputType.FILE);

			            // Save screenshot to target/screenshots/
			            String screenshotName = scenario.getName().replaceAll(" ", "_") + ".png";
			            String screenshotPath = System.getProperty("user.dir") + "/target/screenshots/" + screenshotName;
			            File destFile = new File(screenshotPath);
			            FileUtils.copyFile(srcFile, destFile);

			            // Attach to cucumber report (so you see Failed Screenshot section)
			            final byte[] screenshotBytes = ((TakesScreenshot) driver).getScreenshotAs(OutputType.BYTES);
			            scenario.attach(screenshotBytes, "image/png", screenshotName);

			            // Attach to Extent report
			            com.aventstack.extentreports.cucumber.adapter.ExtentCucumberAdapter
			                .addTestStepScreenCaptureFromPath(screenshotPath);

			        } 
			        catch (Exception e) 
			        {
			            e.printStackTrace();
			        }
			    }
			    DriverFactory.quitDriver();
		 }
}
